package fr.esisar.view;
import fr.esisar.controller.AlbumDAO;
import fr.esisar.controller.ClientDAO;
import fr.esisar.model.Client;
import java.io.IOException;
import java.sql.SQLException;
import java.util.Scanner;



public class Main {

	public static void main(String[] args) throws IOException, ClassNotFoundException, SQLException {
		System.out.println("*****Bienvenue sur la plateforme Esiphoto*****by CS441 group3");
		Main.menuEntree();
	}
	
	public static void menuEntree() throws IOException, ClassNotFoundException, SQLException
	{	
		System.out.println("\n\n*****Esiphoto Menu Entree*****");
		Scanner sc = new Scanner(System.in);
		System.out.println("\nVeuillez taper le numero de l'action a effectuer");
		
		System.out.println("0 : Souscription");
		System.out.println("1 : Connexion");
		System.out.println("2 : Quitter");
		System.out.print("Votre action : ");
		
		String firstAction = sc.nextLine();
	
		System.out.print("\n");
		
		if(firstAction.equals("0"))
		{
			Main.Subscribe();
		}
		else if(firstAction.equals("1"))
		{
			Main.Connexion();
		}
		else if(firstAction.equals("2"))
		{
			sc.close();
			System.out.print("\n\nAurevoir & A bientot ! ");
		}
		else
		{
			System.out.print("Votre choix est incorrect.");
			Main.menuEntree();
		}
		
	}
		
		public static void Subscribe() throws IOException, ClassNotFoundException, SQLException
		{
			Scanner sc = new Scanner(System.in);
			ClientDAO userDAO = null ;
			System.out.println("Veuillez entrer les informations suivantes necessaires a la creation de votre compte: ");
			System.out.println("Nom : ");
			String Nom = sc.nextLine();
			System.out.println("Prenom : ");
			String Prenom = sc.nextLine();
			System.out.println("Mail : ");
			String mail = sc.nextLine();
			System.out.println("Password : ");
			String Password = sc.nextLine();
			
			System.out.println("Rue de livraison");
			String ruel=sc.nextLine();
			System.out.println("codePostal de livraison : ");
			String codePostall = sc.nextLine();
			System.out.println("ville de livraison : ");
			String villel = sc.nextLine();
			System.out.println("Rue de facturation");
			String ruef=sc.nextLine();
			System.out.println("codePostal de facturation : ");
			String codePostalf = sc.nextLine();
			System.out.println("ville de facturation : ");
			String villef = sc.nextLine();
			System.out.println("Login : "+mail+"\npassword : "+Password);
			System.out.println("Creation de votre compte...");
			userDAO = new ClientDAO(mail,Nom,Prenom,Password);
			
			try {
				if(userDAO.EnregistrerClient(userDAO.getFile(),ruel,codePostall,villel,ruef,codePostalf,villef))
				{
					System.out.println("Felicitations ! Votre compte a bien ete enregistre.");
					Main.MenuPrincipal(userDAO);
				}
				else
				{
					System.out.println("Nous sommes desoles. Un compte existe deja pour cette adresse mail");
					Main.menuEntree();
				}
			} catch (ClassNotFoundException | SQLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		}
		
		
		public static void Connexion() throws IOException, ClassNotFoundException, SQLException
		{
			Scanner sc = new Scanner(System.in);
			System.out.println("Mail : ");
			String mail = sc.nextLine();
			System.out.println("Password : ");
			String password = sc.nextLine();
			System.out.println("Connexion a votre compte...");
			ClientDAO userDAO = new ClientDAO(mail,password) ;
			
			try {
				if(userDAO.ConnexionClient(mail, password))
				{
					System.out.println("Connexion reussie.");
					Main.MenuPrincipal(userDAO);
				}
				else
				{
					System.out.println("Nous sommes desoles. La connexion n'a pas aboutie");
					Main.menuEntree();
				}
			} catch (ClassNotFoundException | SQLException e) {
				e.printStackTrace();
			}
		}
					
		public static void MenuPrincipal(ClientDAO userDAO) throws IOException, ClassNotFoundException, SQLException
		{
			Scanner sc = new Scanner(System.in);
			System.out.println("\n\n*****Esiphoto Menu Principal*****");
			System.out.println("\nVeuillez taper le numero de l'action a effectuer");
			
			System.out.println("0 : Creer un Album");
			System.out.println("1 : Supprimer un Album");
			System.out.println("2 : Afficher la liste des Albums");
			System.out.println("3 : Deposer un fichier image");
			System.out.println("4 : Supprimer un fichier image");
			System.out.println("5 : Ajouter un fichier image a l'album...");
			System.out.println("6 : Retirer un fichier image a l'album...");
			System.out.println("7 : Creer une commande"); //Menu specifique
			System.out.println("8 : Reprendre une commande en cours");
			System.out.println("9 : Deconnexion");
			System.out.print("Votre action : ");
			
			String action = sc.nextLine();
					switch(action)
					{
					case "0": 
						System.out.println("Titre de l'album a creer : ");
						String titre = sc.nextLine();
						System.out.println("Sous titre : ");
						String sous_titre = sc.nextLine();
						userDAO.AjouterAlbum(titre, sous_titre);
						Main.MenuPrincipal(userDAO);
					
					case "1":
						System.out.println("Identifiant de l'album a supprimer : ");
						String idAlbum = sc.nextLine();
						userDAO.SupprimerAlbum(idAlbum);
						Main.MenuPrincipal(userDAO);
						
					case "2":
						userDAO.AfficherListeAlbum();
						Main.MenuPrincipal(userDAO);
						
					case "3":
						System.out.println("Veuillez nous preciser les informations suivantes concernant votre fichier image :");
						System.out.println("Chemin d'acces sur le serveur");
						String chemin = sc.nextLine();
						System.out.println("Appareil photo utilise : ");
						String apphoto = sc.nextLine();
						System.out.println("Objectif utilise : ");
						String objectif = sc.nextLine();
						System.out.println("Distance focale : ");
						String focale = sc.nextLine();
						System.out.println("Sensibilite ISO : ");
						String iso = sc.nextLine();
						System.out.println("Ouverture : ");
						String ouverture = sc.nextLine();
						System.out.println("Vitesse d'obturation : ");
						String obturation = sc.nextLine();
						
						userDAO.InsererFichierImage(chemin, apphoto, objectif, focale, iso, ouverture, obturation);
						Main.MenuPrincipal(userDAO);
						
					case "4":
						System.out.println("Veuillez entrer le chemin d'acces du fichier que vous desirer supprimer :");
						String cheminacces = sc.nextLine();
						userDAO.SupprimerFichierImage(cheminacces);
						Main.MenuPrincipal(userDAO);
						
					case "5":
						System.out.println("***Ajouter un fichier image a l'album...***");
						System.out.println("Veuillez entrer les informations suivantes :");
						System.out.println("Chemin d'acces du fichier image : ");
						String cheminAcces = sc.nextLine();
						System.out.println("Identifiant de l'album");
						int id_Album = sc.nextInt();
						System.out.println("Titre de la photo dans l'album : ");
						String titrephoto = sc.nextLine();
						System.out.println("Commentaire sur la photo dans l'album : ");
						String commentaire = sc.nextLine();
						userDAO.AjouterFichierImagetoAlbum(cheminAcces, id_Album, titrephoto, commentaire);
						Main.MenuPrincipal(userDAO);
						
					case "6":
						System.out.println("***Retirer un fichier image a l'album...***");
						System.out.println("Veuillez entrer les informations suivantes :");
						System.out.println("Chemin d'acces du fichier image : ");
						String chemin_Acces = sc.nextLine();
						System.out.println("Identifiant de l'album");
						int idalbum = sc.nextInt();
						userDAO.RetirerFichierImagefromAlbum(chemin_Acces, idalbum);
						Main.MenuPrincipal(userDAO);
						
					case "7":
						Main.ServiceCommande(userDAO);
						
					case "8":
						/*System.out.println("Date de la commande (sous la forme JJ-MM-AA) : ");
						String date = sc.nextLine();
						int idCommande = null;//userDAO.getidCommande(date)
						Main.ServiceCommande(userDAO, idCommande);*/
						
					case "9":
						System.out.println("Deconnexion... ");
						Main.menuEntree();
					}
					
					
		}
		
		public static void ServiceCommande(ClientDAO userDAO) throws ClassNotFoundException, SQLException, IOException
		{
			Scanner sc = new Scanner(System.in);
			//if (idCommande == null)
			//{
				int idCommande = userDAO.CreerCommande();
				System.out.println("idCommande : "+idCommande);
			//}
			
			System.out.println("\n\n*****Esiphoto Menu Commande*****");
			System.out.println("\nVeuillez taper le numero de l'action a effectuer");

			System.out.println("0 : Creer une nouvelle ligne commande");
			System.out.println("1 : Valider votre commande");
			System.out.println("3 : Quitter");
			System.out.print("Votre action : ");
			String action = sc.nextLine();

			switch(action)
			{
			case "0":
				System.out.println("Selectionner votre format parmis la liste suivante : ");
				userDAO.AfficherListeFormat();
				String format = sc.nextLine();
				if(!(format.equals("A1") || format.equals("A2") || format.equals("A3") || format.equals("A4") || format.equals("A5") || format.equals("A6")))
				{
					System.out.println("Erreur : format invalide.");
					Main.ServiceCommande(userDAO);
				}
				System.out.println("Entrer l'identifiant de votre album a commander : ");
				int idAlbum = sc.nextInt();
				System.out.println("Entrer la quantite desiree : ");
				String quantite = sc.nextLine();
				userDAO.CreerLigneCommande(userDAO.getFile(), quantite, idCommande, idAlbum, format);
				Main.ServiceCommande(userDAO);
				
			case "1":
				userDAO.ValiderCommande(userDAO.getFile(), idCommande);
			case "2":
				
			case "3":
				Main.MenuPrincipal(userDAO);
			}
		}

}

