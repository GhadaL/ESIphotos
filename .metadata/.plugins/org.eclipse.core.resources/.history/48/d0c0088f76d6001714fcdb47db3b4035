package fr.esisar.controller;

import fr.esisar.model.*;

import java.sql.*;

public class ContientDAO extends Contient {

	public ContientDAO(int num_ordre, String title, String commentaire) {
		super(num_ordre, title, commentaire);
		
	}

	public static boolean AjouterFichierImagetoAlbum(Connection connect, String url, int idAlbum, String numOrdre,
			String titre, String commentaire)  {
		//si on a besion d'afficher l image 
		//FichierImage image = new FichierImage();
		// image=FichierImageDAO.findByURL(connect, url);
		
		// insert into contient la liaison
		Statement st;
		try {
			st = connect.createStatement();
			// insert the data
			st.executeUpdate("INSERT INTO Contient " + "VALUES ('" + "com" + "', '" + numOrdre + "', '" + titre + "', '"
					+ commentaire + "', '" + url + "', '" + idAlbum + "', '" + "('" + url + "','" + idAlbum + "')" + ")");
			System.out.println("Fichier image ajouté à album id=" + idAlbum);
			// album.ajouterFichierImage(image);
			
			return true;
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
			return false;
		}
		
	}

	public static boolean RetirerFichierImagefromAlbum(Connection connect, String cheminAcces, int idAlbum_int) throws ClassNotFoundException { 	
		String idAlbum = ""+idAlbum_int;
		Statement st;
		try {
			st = connect.createStatement();
			// insert the data
			st.executeUpdate("DELETE FROM CONTIENT WHERE cheminAcces = '"+cheminAcces+"' "+" AND idAlbum = '"+idAlbum+"'");
			System.out.println("Fichier image url= "+cheminAcces+" supprimé de l'album id=" + idAlbum);
			// album.ajouterFichierImage(image);
			//then call method verify in Fichier image to delete the image if it doesn't exist in any album
			ResultSet result = null;
			result=st.executeQuery("SELECT FROM CONTIENT WHERE cheminAcces = '"+cheminAcces+"'");
			boolean del = true;
			while (result.next()) {
				
				if (cheminAcces.equals(result.getString("cheminAcces"))){
						del = false;
					}
			}
			if (del){ //On supprime le fichier image uniquement s'il n'est pas utilise dans un autre albums
				FichierImageDAO.SupprimerFichierImage(connect, result.getString("cheminAcces"));
			}
			return true;
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
			return false;
		}
		
	}
}
